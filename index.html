<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shady Spot Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    #map {
      height: 100vh;
    }
    #formModal {
      position: absolute;
      z-index: 1000;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 20px;
      border: 2px solid black;
      border-radius: 8px;
      display: none;
    }
    #formModal input[type="text"], textarea {
      width: 100%;
      margin-bottom: 10px;
    }
    #formModal label {
      display: block;
      margin: 5px 0;
    }
  </style>
</head>
<body>

<div id="map"></div>

<div id="formModal">
  <h3>Submit a Shady Spot</h3>
  <input type="text" id="markerName" placeholder="Name this spot" />
  <textarea id="description" placeholder="Describe your shady spot"></textarea>
  <p>What time do you benefit from this shady space?</p>
  <label><input type="radio" name="timeday" value="Morning" /> Morning</label>
  <label><input type="radio" name="timeday" value="Midday" /> Midday</label>
  <label><input type="radio" name="timeday" value="Evening" /> Evening</label>
  <label><input type="radio" name="timeday" value="Night" /> Night</label>
  <br />
  <button id="submitForm">Submit</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([43.637869, -79.406311], 13);

  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors',
  }).addTo(map);

  let currentLatLng = null;

  function add(e) {
    currentLatLng = e.latlng;
    document.getElementById('formModal').style.display = 'block';
  }

  document.getElementById('submitForm').addEventListener('click', () => {
    const name = document.getElementById('markerName').value.trim();
    const description = document.getElementById('description').value.trim();
    const timeday = document.querySelector('input[name="timeday"]:checked')?.value;

    if (!name || !description || !timeday) {
      alert('Please complete all fields.');
      return;
    }

    const marker = L.marker(currentLatLng).addTo(map);
    marker.bindPopup(`<b>${name}</b><br>${currentLatLng.toString()}`).openPopup();
    sendToForm(currentLatLng, name, description, timeday);

    // Reset and close the modal
    document.getElementById('formModal').style.display = 'none';
    document.getElementById('markerName').value = '';
    document.getElementById('description').value = '';
    document.querySelectorAll('input[name="timeday"]').forEach(r => r.checked = false);
  });

  function sendToForm(latlng, markerName, description, timeday) {
    const lat = latlng.lat.toFixed(5);
    const lng = latlng.lng.toFixed(5);

    const formUrl = "https://docs.google.com/forms/u/0/d/e/1FAIpQLSfNV5ldiWUsR3nYRD35-_m2W4TSuUuijP3L55uOLdtPwqC2AQ/formResponse";
    const formData = new URLSearchParams();
    formData.append("entry.901935268", lat);     
    formData.append("entry.1956546171", lng);
    formData.append("entry.1519028228", markerName);
    formData.append("entry.772410688", description);
    formData.append("entry.242720066", timeday);

    fetch(formUrl, {
      method: "POST",
      mode: "no-cors",
      body: formData
    }).catch(err => console.error("Error:", err));
  }

  map.on('click', add);
</script>

</body>
</html>

